{% extends "layout.html" %}

{% block content %}
<div class="container-fluid vh-100 d-flex">
    <div class="row flex-grow-1 h-100 w-100">
        <!-- Left Section (Typing Title) -->
        <div class="col-sm-12 col-md-6 d-flex flex-column align-items-start justify-content-center px-5">
            <h1 class="home-title">AI-Powered Image Generation</h1>
            <p class="home-subtitle typing-text" id="typing-title"></p>
            <!-- Get Started Button -->
            <div>
                <button class="btn btn-lg mt-3 ms-5 start-button" onclick="location.href='/login'">Get Started</button>
            </div>
        </div>

        <!-- Right Section (3D Animation using Three.js) -->
        <div class="col-sm-12 col-md-6 d-flex align-items-center justify-content-center position-relative">
            <div id="threejs-container"></div> <!-- Container for Three.js -->
        </div>
    </div>
</div>

<!-- Add CSS to ensure the container is visible -->
<style>
    #threejs-container {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        background: black;
        overflow:hidden;
    }
</style>

<!-- Include Three.js via CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const titleElement = document.getElementById('typing-title');
        typeWriter(titleElement, "Generate AI-generated handwriting with deep learning");
        initThreeJS(); // Initialize Three.js after DOM is loaded
    });

    // ========================
    // Typewriter Effect for Title
    // ========================
    function typeWriter(element, text, speed = 75, isUntyping = false) {
        let i = isUntyping ? text.length : 0;
        
        function type() {
            if (isUntyping ? i > 0 : i < text.length) {
                if (isUntyping) {
                    element.innerHTML = text.substring(0, i - 1);
                    i--;
                } else {
                    element.innerHTML += text.charAt(i);
                    i++;
                }
                setTimeout(type, speed);
            } else {
                // Switch between typing and untyping
                setTimeout(() => {
                    typeWriter(element, text, speed, !isUntyping);
                }, 2000); // Pause before switching
            }
        }
        
        type();
    }
// ========================
// Three.js 3D Animation (AI-Style)
// ========================

function initThreeJS() {
    // Select the container
    const container = document.getElementById("threejs-container");

    if (!container) return;
    container.innerHTML = "";  // Clear previous content

    // Create scene
    const scene = new THREE.Scene();

    // Create camera
    const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.z = 4.5;

    // Create WebGL Renderer
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.shadowMap.enabled = true; // Enable shadows
    container.appendChild(renderer.domElement);

    // ===================
    // 1. AI Core Sphere ðŸŒ (Minimalistic Glow)
    // ===================
    const sphereGeometry = new THREE.IcosahedronGeometry(1.2, 6);
    const sphereMaterial = new THREE.MeshStandardMaterial({ 
        color: 0x888888, // Soft grey
        wireframe: true, 
        emissive: 0x444444 // Subtle glow effect
    });
   
    const aiCore = new THREE.Mesh(sphereGeometry, sphereMaterial);
    aiCore.position.y = 0.8
    aiCore.castShadow = true; // Enable shadow casting
    scene.add(aiCore);

    // ===================
    // 2. White Shadow Plane (Under the Sphere)
    // ===================
    const shadowGeometry = new THREE.PlaneGeometry(3, 3);
    const shadowMaterial = new THREE.ShadowMaterial({ opacity: 0.8 }); // Semi-transparent shadow
    const shadowPlane = new THREE.Mesh(shadowGeometry, shadowMaterial);
    shadowPlane.rotation.x = -Math.PI / 2;
    shadowPlane.position.y = -1.5;
    shadowPlane.receiveShadow = true;
    scene.add(shadowPlane);

    // ===================
    // Lights and Shadows
    // ===================
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);

    const light = new THREE.PointLight(0xffffff, 1.5);
    light.position.set(2, 2, 5);
    light.castShadow = true;
    scene.add(light);


    // ===================
    // Animation Loop
    // ===================
    function animate() {
        requestAnimationFrame(animate);

        let time = Date.now() * 0.0005;

        // Rotate AI Sphere
        aiCore.rotation.y += 0.005;
        aiCore.rotation.x += 0.003;

        renderer.render(scene, camera);
    }

    animate();

    // Handle Resizing
    window.addEventListener("resize", () => {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
    });
}

</script>
{% endblock %}